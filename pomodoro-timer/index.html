<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>01 - Pomodoro || Advent of JavaScript</title>
    <link rel="stylesheet" href="./styles.css" />
    <script
      defer
      src="https://unpkg.com/alpinejs@3.7.0/dist/cdn.min.js"
    ></script>
  </head>

  <body>
    <div
      class="wrapper"
      x-data="{
        time: 900,
        timeRemaining: 900,
        mode: 'finished', 
      }"
    >
      <!-- Timer mode and progress ring indicator -->
      <div
        class="ring"
        x-bind:class="mode"
        x-data="{
          get progress() { return 1595.93 * (1 - this.timeRemaining / this.time); },
        }"
      >
        <svg width="518" height="518" viewBox="0 0 518 518">
          <circle
            cx="50%"
            cy="50%"
            r="254"
            fill="transparent"
            stroke-width="9px"
            stroke-dasharray="1595.93"
            x-bind:stroke-dashoffset="progress"
          />
        </svg>
      </div>

      <!-- Timer display and controls -->
      <div class="timer">
        <!-- Timer display -->
        <div
          class="time"
          x-data="{
            minutes() {
              const mins = Math.floor(this.timeRemaining / 60);
              return mins < 10 ? `0${mins}` : `${mins}` ;
            },
            seconds() {
              const secs = this.timeRemaining % 60;
              return secs < 10 ? `0${secs}` : `${secs}`;
            },
          }"
        >
          <div class="minutes">
            <input type="text" x-bind:value="minutes" disabled />
          </div>
          <div class="colon">:</div>
          <div class="seconds">
            <input type="text" x-bind:value="seconds" disabled />
          </div>
        </div>

        <!-- Timer controls -->
        <div
          x-data="{
            timer: null,
            handleTimer() {
              switch (this.mode){
                case 'finished':
                  this.startTimer(); break;
                case 'running':
                  this.pauseTimer(); break;
                case 'paused':
                  this.resumeTimer(); break;
                default:
                  break;
              }
            },
            startTimer () {
              this.timeRemaining = this.time;
              this.resumeTimer();
              this.timer = setInterval(() => {
                if (this.timeRemaining > 0 && this.mode !== 'paused') { this.timeRemaining--;
                } else if (this.mode === 'paused') {
                } else {this.endTimer()}
              },100);
            },
            pauseTimer() { this.mode = 'paused' },
            resumeTimer() { this.mode = 'running' },
            resetTimer () {
              this.mode = 'finished';
              clearInterval(this.timer);
              this.timeRemaining = this.time;
            },
            endTimer() {
              this.resetTimer();
              alert('Timer Ended')
            },
          }"
        >
          <button
            class="btn"
            x-text="{finished: 'start', running: 'pause', paused: 'resume'}[mode]"
            x-on:click="handleTimer"
          ></button>
          <button class="btn" x-on:click="resetTimer">reset</button>
        </div>
        <button class="settings">
          <img src="images/gear.svg" alt="Settings" />
        </button>
      </div>
    </div>
  </body>
</html>
