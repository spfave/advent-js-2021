<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>01 - Pomodoro || Advent of JavaScript</title>
    <link rel="stylesheet" href="./styles.css" />
    <script
      defer
      src="https://unpkg.com/alpinejs@3.7.0/dist/cdn.min.js"
    ></script>
  </head>

  <body>
    <div
      class="wrapper"
      x-data="{
      time: 900,
      timeRemaining: 900,
      mode: 'finished', 
      timer: null,
      get minutes() {
        const mins = Math.floor(this.timeRemaining / 60);
        return mins < 10 ? `0${mins}` : `${mins}` ;
      },
      get seconds() {
        const secs = this.timeRemaining % 60;
        return secs < 10 ? `0${secs}` : `${secs}`;
      },
      handleTimer() {
        switch (this.mode){
          case 'finished':
            this.startTimer(); break;
          case 'running':
            this.pauseTimer(); break;
          case 'paused':
            this.resumeTimer(); break;
          default:
            break;
        }
      },
      startTimer () {
        this.timeRemaining = this.time;
        this.mode = 'running';
        this.timer = setInterval(() => {
          if (this.timeRemaining > 0 && this.mode !== 'paused') {
            this.timeRemaining--
          } else if (this.mode === 'paused') {
          } else {this.endTimer()}
        },1000);
      },
      pauseTimer() { this.mode = 'paused' },
      resumeTimer() { this.mode = 'running' },
      resetTimer () {
        this.mode = 'finished';
        clearInterval(this.timer);
        this.timeRemaining = this.time;
      },
      endTimer() {
        this.resetTimer();
        alert('Timer Ended')
      },
      timerBtnText(mode) {
        const modeToText = {finished: 'start', running: 'pause', paused: 'resume'};
        return {finished: 'start', running: 'pause', paused: 'resume'}[mode];
      }
    }"
    >
      <div class="ring" x-bind:class="mode">
        <svg width="518" height="518" viewBox="0 0 518 518">
          <circle stroke-width="9px" x="0" y="y" cx="259" cy="259" r="254" />
        </svg>
      </div>

      <div class="timer">
        <div class="time">
          <div class="minutes">
            <input type="text" x-bind:value="minutes" disabled />
          </div>
          <div class="colon">:</div>
          <div class="seconds">
            <input type="text" x-bind:value="seconds" disabled />
          </div>
        </div>
        <div>
          <button
            class="btn"
            x-text="timerBtnText(mode)"
            x-on:click="handleTimer"
          ></button>
          <button class="btn" x-on:click="resetTimer">reset</button>
        </div>
        <button class="settings">
          <img src="images/gear.svg" alt="Settings" />
        </button>
      </div>
    </div>
  </body>
</html>
